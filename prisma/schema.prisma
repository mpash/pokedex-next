// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

// Local Postgres Storage
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

// Vercel Postgres Storage
// datasource db {
//   provider          = "postgresql"
//   url               = env("POSTGRES_PRISMA_URL") // uses connection pooling
//   directUrl         = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
//   shadowDatabaseUrl = env("POSTGRES_URL_NON_POOLING") // used for migrations
// }

model Pokemon {
  id               Int              @id @default(autoincrement())
  sourceId         Int
  name             String
  slug             String
  number           String
  weight           Float
  height           Int
  hp               Int?
  attack           Int?
  defense          Int?
  spAttack         Int?
  spDefense        Int?
  speed            Int?
  image            String
  descriptionX     String
  descriptionY     String
  detailPageURL    String
  collectiblesSlug String
  thumbnailAltText String
  thumbnailImage   String
  subVariant       Int
  evolutionChain   String[]
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  // Relations
  types            PokemonType[]
  weaknesses       PokemonType[]    @relation("PokemonWeaknesses")
  abilities        PokemonAbility[]
  japaneseMeta     JapaneseMeta?
  primaryColor     PrimaryColor?
  regionId         Int?
  region           Region?          @relation(fields: [regionId], references: [id])
  evolvesTo        Pokemon[]        @relation("PokemonEvolutions")
  evolvesFrom      Pokemon[]        @relation("PokemonEvolutions")
  pokemonCards     PokemonCard[]

  // Indexes
  @@index([name], name: "pokemon_name")
  @@index([number], name: "pokemon_number")
  @@index([sourceId], name: "pokemon_source_id")
  @@index([slug], name: "pokemon_slug")
}

model PokemonType {
  id           Int       @id @default(autoincrement())
  type         String    @unique
  // Relations
  pokemon      Pokemon[]
  weakPokemons Pokemon[] @relation("PokemonWeaknesses")

  // Indexes
  @@index([type], name: "pokemon_type")
}

model PokemonAbility {
  id      Int       @id @default(autoincrement())
  ability String    @unique
  // Relations
  pokemon Pokemon[]

  // Indexes
  @@index([ability], name: "pokemon_ability")
}

model JapaneseMeta {
  id         Int     @id @default(autoincrement())
  kyodai_flg Int
  image_s    String
  sub_name   String
  sub        Int
  type_2     Int
  image_m    String
  no         String
  type_1     Int
  takasa     String
  zukan_no   String
  name       String
  omosa      String
  // Relations
  pokemonId  Int     @unique
  pokemon    Pokemon @relation(fields: [pokemonId], references: [id])

  // Indexes
  @@index([name], name: "japanese_meta_name")
}

model PrimaryColor {
  id        Int     @id @default(autoincrement())
  r         Int
  g         Int
  b         Int
  // Relations
  pokemonId Int     @unique
  pokemon   Pokemon @relation(fields: [pokemonId], references: [id])
}

model Region {
  id       Int       @id @default(autoincrement())
  sourceId Int       @unique
  name     String    @unique
  // Relations
  pokemon  Pokemon[]

  // Indexes
  @@index([name], name: "region_name")
}

model PokemonCard {
  id                     Int                      @id @default(autoincrement())
  sourceId               String                   @unique
  data                   Json
  imageSm                String
  imageLg                String
  name                   String
  // Optional
  rules                  String[]
  hp                     String?
  types                  String[]
  abilities              Json?
  attacks                Json?
  weaknesses             Json?
  retreatCost            String[]
  convertedRetreatCost   Int?
  flavorText             String?
  rarity                 String?
  artist                 String?
  // End Optional
  number                 String
  // Relations
  pokemon                Pokemon[]
  pokemonCardSetId       Int?
  set                    PokemonCardSet?          @relation(fields: [pokemonCardSetId], references: [id])
  pokemonCardSuperTypeId Int?
  superType              PokemonCardSetSuperType? @relation(fields: [pokemonCardSuperTypeId], references: [id])
  subTypes               PokemonCardSetSubType[]
}

model PokemonCardSet {
  id           Int           @id @default(autoincrement())
  sourceId     String        @unique
  name         String
  series       String
  printedTotal Int
  total        Int
  legalities   Json
  ptcgoCode    String?
  releaseDate  String
  symbolUrl    String
  logoUrl      String
  pokemonCards PokemonCard[]
}

model PokemonCardSetSuperType {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  // Relations
  pokemonCards PokemonCard[]
}

model PokemonCardSetSubType {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  // Relations
  pokemonCards PokemonCard[]
}
